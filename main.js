(()=>{"use strict";var e=function(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))};function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}function r(e,t,n,r,i){(e.classList.contains("card__like-button_is-active")?r:n)(i).then((function(n){e.classList.toggle("card__like-button_is-active"),o(t,n.likes)})).catch((function(e){console.log(e)}))}function o(e,t){e.textContent=t.length}var i=function(e,t){t(e.data._id).then((function(t){e.remove()})).catch((function(e){console.log(e)}))},a=function(e,t,n){l(e)?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)},c=function(e,t,n,r,o){t.classList.add(n);var i=e.querySelector(".".concat(t.id,"-error"));i&&(i.classList.add(r),i.textContent=o)},u=function(e,t,n,r){t.classList.remove(n);var o=e.querySelector(".".concat(t.id,"-error"));o&&(o.classList.remove(r),o.textContent="")},l=function(e){return e.some((function(e){return!e.validity.valid||e.validity.patternMismatch}))},s=function(e,t){Array.from(e.querySelectorAll("input")).forEach((function(n){u(e,n,t.inputErrorClass,t.errorClass)}))},d=function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))},p="7cb290a2-a3f9-40c7-9678-818c151bd929",f="https://nomoreparties.co/v1/".concat("wff-cohort-33"),m=function(e,t){return fetch(f+e,t).then(d)},_=function(e){return m("/cards/".concat(e),{headers:{authorization:p},method:"DELETE"})},y=function(e){return m("/cards/likes/".concat(e),{headers:{authorization:p},method:"PUT"})},v=function(e){return m("/cards/likes/".concat(e),{headers:{authorization:p},method:"DELETE"})};function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var S,b=document.querySelector(".places__list"),C=document.querySelector(".popup_type_image"),q=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_edit-image"),A=document.forms["edit-profile-image"],D=document.forms["edit-profile"],x=document.querySelector(".profile__info"),w=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_new-card"),j=document.querySelector(".profile__add-button"),O=document.forms["new-place"],z=document.querySelector("#card-template").content;S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(S.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);a(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n.inputErrorClass,n.errorClass):c(e,t,n.inputErrorClass,n.errorClass,t.validationMessage)})(e,o,t),a(n,r,t)}))}))}(e,S)}));var P=function(e,t){e.style="background-image: url(".concat(t,")")},I=function(e,t,n){e.querySelector(".profile__title").textContent=t,e.querySelector(".profile__description").textContent=n},R=function(e,t){var n=function(e,t){var n=e.cardObject,r=e.imagePopup,i=e.userId,a=e.cardTemplate.querySelector(".card").cloneNode(!0);a.data=n;var c=a.querySelector(".card__image"),u=a.querySelector(".card__like-button"),l=a.querySelector(".card__like-counter"),s=a.querySelector(".card__delete-button");return c.src=n.link,c.alt=n.name,o(l,n.likes),function(e,t,n){t.some((function(t){return t._id===e}))&&n.classList.add("card__like-button_is-active")}(i,n.likes,u),a.querySelector(".card__title").textContent=c.alt,function(e,t,n){t!==n&&(e.style.display="none")}(s,i,n.owner._id),s.addEventListener("click",(function(){return t.handleCardDelete(a,t.cardDeleteRequest)})),u.addEventListener("click",(function(){return t.handleCardLike(u,l,t.cardLikeRequest,t.cardDislikeRequest,a.data._id)})),c.addEventListener("click",(function(){return t.handleImageClick(c,r)})),a}({cardObject:e,cardTemplate:z,imagePopup:C,userId:t._id},{handleCardLike:r,cardLikeRequest:y,cardDislikeRequest:v,handleImageClick:B,handleCardDelete:i,cardDeleteRequest:_});b.prepend(n)};g.addEventListener("click",(function(e){t(E),function(e,t){!function(e,t,n){e.elements.name.value=t,e.elements.description.value=n}(e,t.querySelector(".profile__title").textContent,t.querySelector(".profile__description").textContent)}(D,x),s(D,{inputErrorClass:"popup__input_type_error",errorClass:"form__input-error"})})),k.addEventListener("click",(function(e){t(L),s(D,{inputErrorClass:"popup__input_type_error",errorClass:"form__input-error"})})),j.addEventListener("click",(function(){O.reset(),t(T),s(O,{inputErrorClass:"popup__input_type_error",errorClass:"form__input-error"})})),q.forEach((function(e){return(t=e).querySelector(".popup__close").addEventListener("click",(function(){return n(t)})),void t.addEventListener("mousedown",(function(e){return function(e,t){e.target.classList.contains("popup")&&n(t)}(e,t)}));var t})),D.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,r,o){var i,a,c=M(e);(i=t.elements.name.value,a=t.elements.description.value,m("/users/me",{headers:{authorization:p,"Content-Type":"application/json"},method:"PATCH",body:JSON.stringify({name:i,about:a})})).then((function(e){I(r,e.name,e.about),n(o)})).catch((function(e){console.log(e)})).finally((function(){N(e,c)}))}(e.submitter,D,x,E)})),L.addEventListener("submit",(function(e){e.preventDefault();var t,r=M(e.submitter);(t=A.elements.link.value,m("/users/me/avatar",{headers:{authorization:p,"Content-Type":"application/json"},method:"PATCH",body:JSON.stringify({avatar:t})})).then((function(e){P(w,e.avatar),n(L)})).catch((function(e){console.log(e)})).finally((function(){A.reset(),N(e.submitter,r)}))})),O.addEventListener("submit",(function(e){e.preventDefault();var t,r,o=M(e.submitter);(t=O.elements["place-name"].value,r=O.elements.link.value,m("/cards",{headers:{authorization:p,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:t,link:r})})).then((function(e){J.then((function(t){R(e,t)}))})).catch((function(e){console.log(e)})).finally((function(){N(e.submitter,o),O.reset(),n(T)}))}));var B=function(e,n){var r=n.querySelector(".popup__image");r.src=e.src,r.alt=e.alt,n.querySelector(".popup__caption").textContent=e.alt,t(n)},M=function(e){var t=e.textContent;return e.textContent="Сохранение...",t},N=function(e,t){e.textContent=t},J=m("/users/me",{headers:{authorization:p}}).then((function(e){return I(x,e.name,e.about),P(w,e.avatar),e})).catch((function(e){console.log(e)})),H=m("/cards",{headers:{authorization:p}}).then((function(e){return e})),U=function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)};Promise.all([J,H]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],u=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];i.sort(U),i.forEach((function(e){R(e,o)}))})).catch((function(e){console.log(e)}))})();